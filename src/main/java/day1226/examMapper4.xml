<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="day1226">

<sql id="empCommon">
select ename, sal, comm, hiredate
from emp
</sql>

	<!-- 여러 조건에 의한 여러 컬럼이 조회.
	-부서번호와 사원번호를 입력(parameterType="DTO")받아서,
	사원명, 연봉, 보너스, 입사일을(resultType="DTO") 검색 
	ADTO - 입력값 -> where절
	BDTO - 조회값 -> 조회컬럼	
	-->
	<select id="useDomain" parameterType="empDTO" resultType="empDomain">
	<include refid="empCommon"/>
	where deptno=#{deptno} and empno=#{empno}
	</select>

	<!-- like 
	%는 PreparedStatement의 bind변수와 함께 사용되면 인식하지 못한다.
	동에 해당하는 우편번호, 시도, 구군, 동, 번지 검색
	-->
	<resultMap type="zipDomain" id="zipResult">
	<result column="zipcode" property="zipcode" />
	<result column="sido" property="sido" />
	<result column="gugun" property="gugun" />
	<result column="dong" property="dong" />
	<result column="bunji" property="bunji" />
	</resultMap>
	<select id="like" parameterType="String" resultMap="zipResult">
	select zipcode, sido, gugun, dong, bunji 
	from zipcode 
	where dong like #{dong} || '%' 
	</select>
	
	
	<!-- < 작다 
	연봉을 입력받아 입력값보다 연봉이 낮은 사원의 사원명, 연봉, 보너스, 입사일을 검색
	특수문자 : &lt;, CDATA Section ( 문자열 데이터 영역 <![CDATA[ 문제발생문자열 ]]> ) 
	-->
	<!-- 
	<select id="lessThan" parameterType="Integer" resultType="empDomain">
	select ename, sal, comm, hiredate
	from emp
	where sal &lt; #{sal} 
	</select>
	 -->
	<select id="lessThan" parameterType="Integer" resultType="empDomain">
	<include refid="empCommon"/>
	<![CDATA[
	where sal < #{sal} 
	]]>
	</select>
	
	<!-- > 크다 
	연봉을 입력받아 입력값보다 연봉이 많은 사원의 사원명, 연봉, 보너스, 입사일을 검색
	-->
	<!-- <select id="greaterThan" parameterType="Integer" resultType="empDomain">
	<include refid="empCommon"/>
	where sal &gt; #{sal} 
	</select> -->
	<select id="greaterThan" parameterType="Integer" resultType="empDomain">
	<include refid="empCommon"/>
	<![CDATA[
	where sal > #{sal} 
	]]>
	</select>
	
	
	<!-- subquery 
	사원테이블에서 가장 마지막에 입사한 사원보다 직전 입사한 사원부터
	10명의 사원 정보를 검색. 검색 컬럼은 사원번호, 사원명, 연봉, 입사일 
	-->
	<select id="subquery" resultType="eaDomain">
	select empno, ename, sal, hiredate
	from(
		select rownum r, empno, ename, sal, hiredate
		from(
			select empno, ename, sal, hiredate
			from emp
			order by hiredate desc))
	where r between 2 and 11
	</select>
	
	<!-- union : 여러 테이블을 위에서 아래로 붙일 때 사용.
	emp - 본사, cp_emp5 - 지사
	본사와 지사의 모든 사원을 검색. 
	사원번호, 사원명, 직무, 매니저번호, 입사일, 연봉, 부서번호
	-->
	<resultMap type="eaDomain" id="eaResult">
	<result column="ENAME" property="ename"/>
	<result column="EMPNO" property="empno"/>
	<result column="JOB" property="job"/>
	<result column="MGR" property="mgr"/>
	<result column="HIREDATE" property="hiredate"/>
	<result column="SAL" property="sal"/>
	<result column="DEPTNO" property="deptno"/>
	<result column="OFFICE_TYPE" property="officeType"/>
	</resultMap>
	<select id="union" resultMap="eaResult" >
	select empno, ename, job, mgr, hiredate, sal, deptno, '본사' office_type from emp
	union all
	select empno, ename, job, mgr, hiredate, sal, deptno, '지사' office_type from cp_emp5
	</select>
	
	<!-- join : 여러 테이블을 옆으로 붙여서 조회할 때 사용.
	보유 중인 모든 차량의 제조사, 모델명, 연식, 가격, 배기량, 입력일을 조회
	-->
	<select id="join" resultType="cmoDomain">
	select cma.maker, cmo.model, cmo.car_year, cmo.price, cmo.cc, cmo.car_img, cmo.input_date
	from car_maker cma, car_model cmo
	where cma.model = cmo.model
	order by cmo.input_date desc
	</select>
	
	
	<!-- subquery & join -->
	<!-- $의 사용 -->
	<!-- dynamic query : if -->
	<!-- dynamic query : choose -->
	<!-- dynamic query : forEach -->
	<!-- dynamic query : set -->
	<!-- PL/SQL insert, update, delete, cursor -->
	
</mapper>